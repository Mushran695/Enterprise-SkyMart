server {
  listen 80;
  server_name _;

  # Forward auth
  location /api/auth/ {
    proxy_pass http://auth-service:3000$request_uri;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # Forward products
  location /api/products/ {
    proxy_pass http://product-service:3001$request_uri;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # Orders
  location /api/orders/ {
    proxy_pass http://order-service:3002$request_uri;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # Payment
  location /api/payment/ {
    proxy_pass http://payment-service:3003$request_uri;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # Admin analytics -> analytics-service (keep heavy analytics here)
  location /api/admin/analytics/ {
    proxy_pass http://analytics-service:3004$request_uri;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # Admin CRUD -> admin-service (users, products, orders-simple)
  location /api/admin/ {
    proxy_pass http://admin-service:3005$request_uri;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # Analytics -> analytics-service (non-admin analytics paths)
  location /api/analytics/ {
    proxy_pass http://analytics-service:3004$request_uri;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # Fallback for health
  location / {
    return 200 'OK';
  }
}
